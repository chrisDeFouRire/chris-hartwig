---
import { getCollection } from 'astro:content';
import BlogLayout from '../../layouts/BlogLayout.astro';
import NewsletterLayout from '../../layouts/NewsletterLayout.astro';

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  return posts.map((post) => {
    return {
      params: { slug: post.slug },
      props: { post },
    };
  });
}

const { post } = Astro.props;

// Dynamically import the MDX content
const Content = await post.render();

const isNewsletter = post.data.tags?.includes('newsletter');
const issueNumber = post.data.issueNumber || 'N/A';
---

{isNewsletter ? (
  <NewsletterLayout
    title={post.data.title}
    description={post.data.description}
    pubDate={post.data.pubDate}
    author={post.data.author}
    issueNumber={issueNumber}
  >
    <article class="prose prose-lg max-w-none">
      <Content.Content />
    </article>
  </NewsletterLayout>
) : (
  <BlogLayout
    title={post.data.title}
    description={post.data.description}
    pubDate={post.data.pubDate}
    author={post.data.author}
    readingTime={Math.ceil(post.body.length / 1000)}
  >
    <article class="prose prose-lg max-w-none">
      <Content.Content />
    </article>
  </BlogLayout>
)}
