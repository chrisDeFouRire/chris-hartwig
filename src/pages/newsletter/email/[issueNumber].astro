---
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  // Filter posts that have an issueNumber
  const newsletterPosts = posts.filter((post) => post.data.issueNumber !== undefined);

  return newsletterPosts.map((post) => {
    return {
      params: { issueNumber: post.data.issueNumber!.toString() },
      props: { post },
    };
  });
}

const { post } = Astro.props;
const Content = await post.render();
const issueNumber = post.data.issueNumber!;
const webUrl = `${Astro.site}blog/${post.slug}/`;
---

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>{post.data.title} | Newsletter Issue #{issueNumber}</title>
  <!--[if mso]>
  <noscript>
    <xml>
      <o:OfficeDocumentSettings>
        <o:PixelsPerInch>96</o:PixelsPerInch>
      </o:OfficeDocumentSettings>
    </xml>
  </noscript>
  <![endif]-->
</head>
<body style="margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; background-color: #f5f5f5; line-height: 1.6; color: #333333;">
  <!-- Wrapper table for email clients -->
  <table role="presentation" cellspacing="0" cellpadding="0" border="0" width="100%" style="background-color: #f5f5f5;">
    <tr>
      <td align="center" style="padding: 20px 0;">
        <!-- Main content table -->
        <table role="presentation" cellspacing="0" cellpadding="0" border="0" width="600" style="max-width: 600px; background-color: #ffffff; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
          <!-- Header -->
          <tr>
            <td style="padding: 30px 30px 20px 30px; border-bottom: 1px solid #e5e5e5;">
              <div style="display: inline-block; padding: 6px 12px; background-color: #5a4ae3; color: #ffffff; font-size: 12px; font-weight: 600; border-radius: 20px; margin-bottom: 16px;">
                Newsletter Issue #{issueNumber}
              </div>
              <h1 style="margin: 0 0 12px 0; font-size: 28px; font-weight: 700; color: #1a1a1a; line-height: 1.2;">
                {post.data.title}
              </h1>
              <div style="font-size: 14px; color: #666666; margin-top: 8px;">
                <span>{new Date(post.data.pubDate).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</span>
                <span style="margin: 0 8px;">•</span>
                <span>By {post.data.author}</span>
              </div>
            </td>
          </tr>

          <!-- Content -->
          <tr>
            <td style="padding: 30px;">
              <div style="font-size: 16px; line-height: 1.8; color: #333333;">
                <style>
                  /* Email-safe styles */
                  .email-content h2 { font-size: 24px; font-weight: 700; margin: 24px 0 16px 0; color: #1a1a1a; line-height: 1.3; }
                  .email-content h3 { font-size: 20px; font-weight: 600; margin: 20px 0 12px 0; color: #1a1a1a; line-height: 1.3; }
                  .email-content p { margin: 0 0 16px 0; }
                  .email-content ul, .email-content ol { margin: 0 0 16px 0; padding-left: 24px; }
                  .email-content li { margin: 0 0 8px 0; }
                  .email-content a { color: #5a4ae3; text-decoration: underline; }
                  .email-content a:hover { color: #4a3ad3; }
                  .email-content strong { font-weight: 600; }
                  .email-content em { font-style: italic; }
                  .email-content code { background-color: #f5f5f5; padding: 2px 6px; border-radius: 3px; font-family: 'Courier New', monospace; font-size: 14px; }
                  .email-content pre { background-color: #f5f5f5; padding: 16px; border-radius: 4px; overflow-x: auto; margin: 16px 0; }
                  .email-content blockquote { border-left: 4px solid #5a4ae3; padding-left: 16px; margin: 16px 0; color: #666666; font-style: italic; }
                </style>
                <div class="email-content">
                  <Content.Content />
                </div>
              </div>
            </td>
          </tr>

          <!-- Footer -->
          <tr>
            <td style="padding: 20px 30px 30px 30px; border-top: 1px solid #e5e5e5; background-color: #fafafa;">
              <div style="text-align: center; margin-bottom: 20px;">
                <a href={webUrl} style="display: inline-block; padding: 12px 24px; background-color: #5a4ae3; color: #ffffff; text-decoration: none; border-radius: 6px; font-weight: 600; font-size: 16px;">
                  Read Online
                </a>
              </div>
              <div style="text-align: center; font-size: 12px; color: #999999; line-height: 1.6;">
                <p style="margin: 0 0 8px 0;">
                  You're receiving this because you subscribed to the Vibe Software Engineering newsletter.
                </p>
                <p style="margin: 0;">
                  <a href={`${Astro.site}unsubscribe`} style="color: #999999; text-decoration: underline;">Unsubscribe</a>
                  <span style="margin: 0 8px;">•</span>
                  <a href={`${Astro.site}newsletter/archive`} style="color: #999999; text-decoration: underline;">Archive</a>
                </p>
              </div>
            </td>
          </tr>
        </table>
      </td>
    </tr>
  </table>
</body>
</html>
